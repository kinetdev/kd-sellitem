<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KD Bán Vật Phẩm - Xem Trước</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@300;400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Chakra Petch', sans-serif;
            color: white;
        }

        body {
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-image: url(https://wallpapercat.com/w/full/0/5/3/130627-3840x2160-desktop-4k-grand-theft-auto-5-wallpaper-image.jpg);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            overflow: hidden;
        }

        /* Thêm keyframes cho hiệu ứng futuristic UI */
        @keyframes circuit-pulse {
            0% { opacity: 0.3; }
            50% { opacity: 0.8; }
            100% { opacity: 0.3; }
        }

        @keyframes tech-scan {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 100%; }
        }

        @keyframes tech-light {
            0% { box-shadow: 0 0 5px #00b4fa, 0 0 10px #00b4fa; }
            50% { box-shadow: 0 0 15px #00b4fa, 0 0 20px #00b4fa; }
            100% { box-shadow: 0 0 5px #00b4fa, 0 0 10px #00b4fa; }
        }

        /* Container chính với viền futuristic */
        .container {
            width: 800px;
            background-color: rgba(10, 15, 25, 0.95);
            display: flex;
            flex-direction: column;
            color: #fff;
            position: relative;
            overflow: hidden;
            border: none;
            box-shadow: 0 0 10px rgba(0, 180, 250, 0.5);
        }

        /* Thêm khung futuristic */
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, transparent 20px, #00b4fa 20px, #00b4fa 22px, transparent 22px) top left / 100px 2px no-repeat,
                linear-gradient(90deg, transparent 40px, #00b4fa 40px, #00b4fa 42px, transparent 42px) top left / 100px 2px no-repeat,
                linear-gradient(90deg, transparent 60px, #00b4fa 60px, transparent 100px) top left / 100px 2px no-repeat,
                linear-gradient(0deg, transparent 20px, #00b4fa 20px, #00b4fa 22px, transparent 22px) top left / 2px 100px no-repeat,
                linear-gradient(0deg, transparent 40px, #00b4fa 40px, #00b4fa 42px, transparent 42px) top left / 2px 100px no-repeat,
                linear-gradient(0deg, transparent 60px, #00b4fa 60px, transparent 100px) top left / 2px 100px no-repeat,
                
                linear-gradient(-90deg, transparent 20px, #00b4fa 20px, #00b4fa 22px, transparent 22px) top right / 100px 2px no-repeat,
                linear-gradient(-90deg, transparent 40px, #00b4fa 40px, #00b4fa 42px, transparent 42px) top right / 100px 2px no-repeat,
                linear-gradient(-90deg, transparent 60px, #00b4fa 60px, transparent 100px) top right / 100px 2px no-repeat,
                linear-gradient(0deg, transparent 20px, #00b4fa 20px, #00b4fa 22px, transparent 22px) top right / 2px 100px no-repeat,
                linear-gradient(0deg, transparent 40px, #00b4fa 40px, #00b4fa 42px, transparent 42px) top right / 2px 100px no-repeat,
                linear-gradient(0deg, transparent 60px, #00b4fa 60px, transparent 100px) top right / 2px 100px no-repeat,
                
                linear-gradient(-90deg, transparent 20px, #00b4fa 20px, #00b4fa 22px, transparent 22px) bottom right / 100px 2px no-repeat,
                linear-gradient(-90deg, transparent 40px, #00b4fa 40px, #00b4fa 42px, transparent 42px) bottom right / 100px 2px no-repeat,
                linear-gradient(-90deg, transparent 60px, #00b4fa 60px, transparent 100px) bottom right / 100px 2px no-repeat,
                linear-gradient(180deg, transparent 20px, #00b4fa 20px, #00b4fa 22px, transparent 22px) bottom right / 2px 100px no-repeat,
                linear-gradient(180deg, transparent 40px, #00b4fa 40px, #00b4fa 42px, transparent 42px) bottom right / 2px 100px no-repeat,
                linear-gradient(180deg, transparent 60px, #00b4fa 60px, transparent 100px) bottom right / 2px 100px no-repeat,
                
                linear-gradient(90deg, transparent 20px, #00b4fa 20px, #00b4fa 22px, transparent 22px) bottom left / 100px 2px no-repeat,
                linear-gradient(90deg, transparent 40px, #00b4fa 40px, #00b4fa 42px, transparent 42px) bottom left / 100px 2px no-repeat,
                linear-gradient(90deg, transparent 60px, #00b4fa 60px, transparent 100px) bottom left / 100px 2px no-repeat,
                linear-gradient(180deg, transparent 20px, #00b4fa 20px, #00b4fa 22px, transparent 22px) bottom left / 2px 100px no-repeat,
                linear-gradient(180deg, transparent 40px, #00b4fa 40px, #00b4fa 42px, transparent 42px) bottom left / 2px 100px no-repeat,
                linear-gradient(180deg, transparent 60px, #00b4fa 60px, transparent 100px) bottom left / 2px 100px no-repeat;
            pointer-events: none;
            z-index: 10;
        }

        /* Thêm đường viền phát sáng */
        .container::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            right: 2px;
            bottom: 2px;
            border: 1px solid rgba(0, 180, 250, 0.3);
            box-shadow: inset 0 0 15px rgba(0, 180, 250, 0.2);
            pointer-events: none;
            z-index: 5;
        }

        /* Header với viền futuristic */
        .header {
            padding: 20px;
            background-color: rgba(5, 20, 35, 0.9);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: none;
            position: relative;
            margin: 10px;
        }

        /* Thêm viền futuristic cho header */
        .header::before {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                transparent 5%, 
                #00b4fa 5%, 
                #00b4fa 45%, 
                transparent 45%, 
                transparent 55%, 
                #00b4fa 55%, 
                #00b4fa 95%, 
                transparent 95%, 
                transparent 100%
            );
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 8px;
            background-color: rgba(0, 180, 250, 0.7);
            clip-path: polygon(0 0, 50% 100%, 100% 0);
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            text-shadow: 0 0 10px rgba(0, 180, 250, 0.8);
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        /* Nâng cấp style cho close-btn */
        .close-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: rgba(255, 59, 48, 0.3);
            border: 1px solid rgba(255, 59, 48, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
            box-shadow: 0 0 8px rgba(255, 59, 48, 0.5);
            position: relative;
        }

        .close-btn:hover {
            background-color: rgba(255, 59, 48, 0.5);
            box-shadow: 0 0 15px rgba(255, 59, 48, 0.7);
            transform: scale(1.1);
        }

        /* Căn chỉnh lại vị trí icon */
        .close-btn i {
            font-size: 18px;
            color: #ffffff;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
            line-height: 1;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 18px;
            height: 18px;
            justify-content: center;
            align-items: center;
        }

        /* Trường hợp Font Awesome không hoạt động, sử dụng chữ X thay thế */
        .close-btn i:empty::before {
            content: '✕';
            font-weight: bold;
        }

        /* Cải thiện thiết kế cho category-tabs */
        .category-tabs {
            display: flex;
            padding: 0 15px;
            border-bottom: 1px solid rgba(0, 180, 250, 0.5);
            overflow-x: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 180, 250, 0.5) transparent;
            background-color: rgba(0, 15, 30, 0.85);
            position: relative;
            gap: 3px; /* Thêm khoảng cách giữa các tab */
        }

        /* Hiệu ứng backdrop glow cho category-tabs */
        .category-tabs::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(0, 180, 250, 0.8) 20%, 
                rgba(0, 180, 250, 0.8) 80%, 
                transparent 100%
            );
            box-shadow: 0 0 10px rgba(0, 180, 250, 0.6);
            z-index: 1;
        }

        .category-tabs::-webkit-scrollbar {
            height: 4px;
        }

        .category-tabs::-webkit-scrollbar-thumb {
            background-color: rgba(0, 180, 250, 0.5);
            border-radius: 2px;
        }

        /* Cải thiện thiết kế cho category-tab */
        .category-tab {
            padding: 12px 20px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            border-bottom: 2px solid transparent;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            position: relative;
            overflow: hidden;
            margin: 3px 0;
            font-weight: 600;
            z-index: 2;
            clip-path: polygon(
                5px 0, 
                100% 0, 
                100% calc(100% - 5px), 
                calc(100% - 5px) 100%, 
                0 100%, 
                0 5px
            );
        }

        /* Hiệu ứng hover cho category-tab */
        .category-tab:hover {
            color: #00b4fa;
            background-color: rgba(0, 30, 60, 0.4);
        }

        /* Hiệu ứng khi tab được active */
        .category-tab.active {
            color: #ffffff;
            border-bottom: 2px solid #00b4fa;
            text-shadow: 0 0 10px rgba(0, 180, 250, 0.8);
            background-color: rgba(0, 60, 120, 0.4);
        }

        /* Hiệu ứng border góc cho tab active */
        .category-tab.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                linear-gradient(90deg, #00b4fa 0px, transparent 15px) top left / 30px 1px no-repeat,
                linear-gradient(0deg, #00b4fa 0px, transparent 15px) top left / 1px 30px no-repeat,
                
                linear-gradient(-90deg, #00b4fa 0px, transparent 15px) top right / 30px 1px no-repeat,
                linear-gradient(0deg, #00b4fa 0px, transparent 15px) top right / 1px 30px no-repeat;
            pointer-events: none;
            z-index: -1;
        }

        /* Hiệu ứng scan cho tab active */
        .category-tab.active::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent 0%,
                rgba(0, 180, 250, 0.1) 50%, 
                transparent 100%
            );
            animation: tab-scan 2s infinite linear;
            z-index: -1;
        }

        @keyframes tab-scan {
            0% { transform: translateX(0); }
            100% { transform: translateX(200%); }
        }

        /* Hiệu ứng cho indicator tab active */
        .category-tab.active span {
            position: relative;
        }

        .category-tab.active span::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: #00b4fa;
            box-shadow: 0 0 5px #00b4fa, 0 0 10px #00b4fa;
        }

        .items-container {
            padding: 15px;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 15px;
            max-height: 500px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 180, 250, 0.5) transparent;
            background-color: rgba(10, 15, 25, 0.8);
        }

        .items-container::-webkit-scrollbar {
            width: 4px;
        }

        .items-container::-webkit-scrollbar-thumb {
            background-color: rgba(0, 180, 250, 0.5);
            border-radius: 2px;
        }

        /* Thiết kế item-card với viền futuristic */
        .item-card {
            background-color: rgba(15, 25, 35, 0.85);
            padding: 12px;
            display: flex;
            flex-direction: column;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(0, 180, 250, 0.3);
            min-height: 160px;
            position: relative;
            overflow: hidden;
        }

        /* Tạo viền góc futuristic cho các item */
        .item-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background:
                linear-gradient(90deg, #00b4fa 0px, transparent 15px) top left / 30px 1px no-repeat,
                linear-gradient(0deg, #00b4fa 0px, transparent 15px) top left / 1px 30px no-repeat,
                
                linear-gradient(-90deg, #00b4fa 0px, transparent 15px) top right / 30px 1px no-repeat,
                linear-gradient(0deg, #00b4fa 0px, transparent 15px) top right / 1px 30px no-repeat,
                
                linear-gradient(-90deg, #00b4fa 0px, transparent 15px) bottom right / 30px 1px no-repeat,
                linear-gradient(180deg, #00b4fa 0px, transparent 15px) bottom right / 1px 30px no-repeat,
                
                linear-gradient(90deg, #00b4fa 0px, transparent 15px) bottom left / 30px 1px no-repeat,
                linear-gradient(180deg, #00b4fa 0px, transparent 15px) bottom left / 1px 30px no-repeat;
            z-index: 2;
        }

        /* Thêm hiệu ứng quét cho item khi hover */
        .item-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, transparent 0%, transparent 40%, rgba(0, 180, 250, 0.1) 50%, transparent 60%, transparent 100%);
            transform: translateY(100%) translateX(-100%);
            transition: transform 0.5s ease;
        }

        .item-card:hover::after {
            transform: translateY(-100%) translateX(100%);
        }

        .item-card:hover {
            box-shadow: 0 0 15px rgba(0, 180, 250, 0.4);
            border-color: rgba(0, 180, 250, 0.8);
            background-color: rgba(20, 40, 60, 0.95);
        }

        /* Item name với hiệu ứng futuristic */
        .item-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 5px;
            text-align: center;
            background-color: rgba(0, 30, 60, 0.7);
            padding: 5px;
            letter-spacing: 0.5px;
            position: relative;
            border-left: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .item-name::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 5px;
            height: 100%;
            background-color: #00b4fa;
        }

        .item-name::after {
            content: '<>';
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 10px;
            color: rgba(0, 180, 250, 0.8);
            font-family: monospace;
        }

        /* Item price với hiệu ứng futuristic */
        .item-price {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #ffffff;
            background-color: rgba(0, 50, 80, 0.5);
            padding: 5px 15px;
            margin-top: auto;
            text-shadow: 0 0 5px rgba(0, 180, 250, 0.8);
            position: relative;
            letter-spacing: 0.5px;
            border: none;
        }

        .item-price::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, #00b4fa, transparent 30%) top left / 100% 1px no-repeat,
                linear-gradient(90deg, transparent 70%, #00b4fa) bottom left / 100% 1px no-repeat;
        }

        /* Modal futuristic redesign */
        .modal-content {
            width: 400px;
            background-color: rgba(10, 20, 30, 0.95);
            overflow: hidden;
            border: none;
            position: relative;
        }

        .modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, #00b4fa 0px, transparent 40px) top left / 120px 2px no-repeat,
                linear-gradient(0deg, #00b4fa 0px, transparent 40px) top left / 2px 120px no-repeat,
                
                linear-gradient(-90deg, #00b4fa 0px, transparent 40px) top right / 120px 2px no-repeat,
                linear-gradient(0deg, #00b4fa 0px, transparent 40px) top right / 2px 120px no-repeat,
                
                linear-gradient(-90deg, #00b4fa 0px, transparent 40px) bottom right / 120px 2px no-repeat,
                linear-gradient(180deg, #00b4fa 0px, transparent 40px) bottom right / 2px 120px no-repeat,
                
                linear-gradient(90deg, #00b4fa 0px, transparent 40px) bottom left / 120px 2px no-repeat,
                linear-gradient(180deg, #00b4fa 0px, transparent 40px) bottom left / 2px 120px no-repeat;
            z-index: 10;
            pointer-events: none;
        }

        .modal-content::after {
            content: '';
            position: absolute;
            inset: 5px;
            border: 1px solid rgba(0, 180, 250, 0.3);
            box-shadow: inset 0 0 15px rgba(0, 180, 250, 0.2);
            pointer-events: none;
            z-index: 2;
        }

        /* Header modal futuristic */
        .modal-header {
            padding: 15px 20px;
            background-color: rgba(0, 40, 70, 0.9);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: none;
            position: relative;
            z-index: 3;
        }

        .modal-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                #00b4fa 20%, 
                #00b4fa 40%, 
                transparent 40%, 
                transparent 60%, 
                #00b4fa 60%, 
                #00b4fa 80%, 
                transparent 80%, 
                transparent 100%
            );
        }

        .modal-header h2 {
            display: flex;
            align-items: center;
        }

        .modal-header h2::before {
            content: '[';
            color: #00b4fa;
            margin-right: 5px;
            font-weight: bold;
        }

        .modal-header h2::after {
            content: ']';
            color: #00b4fa;
            margin-left: 5px;
            font-weight: bold;
        }

        /* Buttons futuristic style */
        .amount-btn {
            width: 40px;
            height: 40px;
            background-color: rgba(0, 50, 100, 0.5);
            color: white;
            border: none;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-shadow: 0 0 5px rgba(0, 180, 250, 0.8);
            overflow: hidden;
        }

        .amount-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, #00b4fa, transparent 40%) top left / 100% 1px no-repeat,
                linear-gradient(0deg, #00b4fa, transparent 40%) top left / 1px 100% no-repeat,
                linear-gradient(180deg, #00b4fa, transparent 40%) bottom left / 1px 100% no-repeat,
                linear-gradient(90deg, transparent 60%, #00b4fa) top right / 100% 1px no-repeat,
                linear-gradient(0deg, #00b4fa, transparent 40%) top right / 1px 100% no-repeat,
                linear-gradient(180deg, #00b4fa, transparent 40%) bottom right / 1px 100% no-repeat,
                linear-gradient(-90deg, #00b4fa, transparent 40%) bottom right / 100% 1px no-repeat,
                linear-gradient(-90deg, transparent 60%, #00b4fa) bottom left / 100% 1px no-repeat;
            z-index: 1;
        }

        .amount-btn:hover {
            background-color: rgba(0, 100, 180, 0.7);
        }

        /* Input futuristic style */
        #amount-input {
            width: 80px;
            height: 40px;
            background-color: rgba(0, 20, 40, 0.7);
            border: 1px solid rgba(0, 180, 250, 0.5);
            color: white;
            text-align: center;
            font-size: 16px;
            margin: 0 10px;
            outline: none;
            text-shadow: 0 0 5px rgba(0, 180, 250, 0.8);
            position: relative;
        }

        /* Confirmation button futuristic */
        #confirm-btn {
            background-color: rgba(0, 100, 150, 0.7);
            color: white;
            border: none;
            position: relative;
            overflow: hidden;
            padding: 10px 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 0;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            box-shadow: 0 0 8px rgba(0, 180, 250, 0.3);
        }

        #confirm-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, #00b4fa, transparent 40%) top left / 100% 1px no-repeat,
                linear-gradient(0deg, #00b4fa, transparent 40%) top left / 1px 100% no-repeat,
                linear-gradient(180deg, #00b4fa, transparent 40%) bottom left / 1px 100% no-repeat,
                linear-gradient(90deg, transparent 60%, #00b4fa) top right / 100% 1px no-repeat,
                linear-gradient(0deg, #00b4fa, transparent 40%) top right / 1px 100% no-repeat,
                linear-gradient(180deg, #00b4fa, transparent 40%) bottom right / 1px 100% no-repeat,
                linear-gradient(-90deg, #00b4fa, transparent 40%) bottom right / 100% 1px no-repeat,
                linear-gradient(-90deg, transparent 60%, #00b4fa) bottom left / 100% 1px no-repeat;
            z-index: 1;
            pointer-events: none;
        }

        #confirm-btn:hover {
            background-color: rgba(0, 130, 200, 0.9);
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(0, 180, 250, 0.7);
        }

        /* Controls for live preview */
        .preview-controls {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 20, 40, 0.8);
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            border: 1px solid rgba(0, 180, 250, 0.5);
            box-shadow: 0 0 10px rgba(0, 180, 250, 0.3);
            clip-path: polygon(
                0 10px, 10px 0,
                calc(100% - 10px) 0, 100% 10px,
                100% calc(100% - 10px), calc(100% - 10px) 100%,
                10px 100%, 0 calc(100% - 10px)
            );
        }

        .preview-controls button {
            padding: 8px 15px;
            background-color: rgba(0, 100, 150, 0.7);
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid rgba(0, 180, 250, 0.3);
            text-shadow: 0 0 5px rgba(0, 180, 250, 0.8);
        }

        .preview-controls button:hover {
            background-color: rgba(0, 130, 200, 0.8);
            box-shadow: 0 0 10px rgba(0, 180, 250, 0.5);
        }

        .price-modifier select, .zone-selector select {
            background-color: rgba(0, 20, 40, 0.7);
            border: 1px solid rgba(0, 180, 250, 0.3);
            color: white;
            padding: 5px;
            border-radius: 3px;
            text-shadow: 0 0 5px rgba(0, 180, 250, 0.5);
        }

        /* Chỉnh sửa total-price-container với viền futuristic */
        .total-price-container {
            background-color: rgba(0, 20, 40, 0.7);
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: none;
            position: relative;
            overflow: hidden;
        }

        .total-price-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                linear-gradient(90deg, #00b4fa, transparent 20%) top left / 50% 1px no-repeat,
                linear-gradient(0deg, #00b4fa, transparent 30%) top left / 1px 50% no-repeat,
                linear-gradient(90deg, transparent 80%, #00b4fa) top right / 50% 1px no-repeat,
                linear-gradient(0deg, transparent 70%, #00b4fa) bottom left / 1px 50% no-repeat,
                linear-gradient(90deg, #00b4fa, transparent 20%) bottom left / 50% 1px no-repeat,
                linear-gradient(90deg, transparent 80%, #00b4fa) bottom right / 50% 1px no-repeat;
        }

        .total-price-label {
            font-weight: 600;
            font-size: 16px;
            text-shadow: 0 0 5px rgba(0, 180, 250, 0.8);
            display: flex;
            align-items: center;
        }

        .total-price-label::before {
            content: '//';
            color: #00b4fa;
            margin-right: 5px;
            font-family: monospace;
        }

        .total-price-value {
            font-size: 22px;
            font-weight: 700;
            color: #4cff64;
            text-shadow: 0 0 10px rgba(76, 255, 100, 0.8);
            letter-spacing: 1px;
            position: relative;
            padding-right: 15px;
        }

        .total-price-value::after {
            content: '$';
            position: absolute;
            right: 0;
            top: 0;
            font-size: 14px;
            color: rgba(76, 255, 100, 0.6);
        }

        /* Chỉnh sửa modal-footer với viền futuristic */
        .modal-footer {
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            border-top: none;
            background-color: rgba(0, 20, 40, 0.7);
            position: relative;
            z-index: 3;
        }

        .modal-footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                #00b4fa 20%, 
                #00b4fa 40%, 
                transparent 40%, 
                transparent 60%, 
                #00b4fa 60%, 
                #00b4fa 80%, 
                transparent 80%, 
                transparent 100%
            );
        }

        .modal-footer::after {
            content: '';
            position: absolute;
            bottom: 15px;
            right: 15px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #00b4fa;
            box-shadow: 0 0 5px #00b4fa, 0 0 10px #00b4fa;
            animation: circuit-pulse 2s infinite;
        }

        /* Thêm hiển thị ảnh sản phẩm trong footer */
        .modal-footer-item-image {
            display: none;
        }

        /* Chỉnh sửa cancel-btn với viền futuristic */
        #cancel-btn {
            background-color: rgba(50, 50, 50, 0.7);
            color: white;
            border: none;
            position: relative;
            overflow: hidden;
            padding: 10px 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 0;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            box-shadow: 0 0 8px rgba(255, 59, 48, 0.3);
        }

        #cancel-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, #ff3b30, transparent 40%) top left / 100% 1px no-repeat,
                linear-gradient(0deg, #ff3b30, transparent 40%) top left / 1px 100% no-repeat,
                linear-gradient(180deg, #ff3b30, transparent 40%) bottom left / 1px 100% no-repeat,
                linear-gradient(90deg, transparent 60%, #ff3b30) top right / 100% 1px no-repeat,
                linear-gradient(0deg, #ff3b30, transparent 40%) top right / 1px 100% no-repeat,
                linear-gradient(180deg, #ff3b30, transparent 40%) bottom right / 1px 100% no-repeat,
                linear-gradient(-90deg, #ff3b30, transparent 40%) bottom right / 100% 1px no-repeat,
                linear-gradient(-90deg, transparent 60%, #ff3b30) bottom left / 100% 1px no-repeat;
            z-index: 1;
            pointer-events: none;
        }

        #cancel-btn:hover {
            background-color: rgba(100, 30, 30, 0.8);
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(255, 59, 48, 0.5);
        }

        /* Chỉnh sửa modal-item-details với viền futuristic */
        .modal-item-details {
            display: flex;
            margin-bottom: 15px;
            background-color: rgba(0, 20, 40, 0.7);
            padding: 15px;
            border: none;
            position: relative;
            overflow: hidden;
            gap: 20px;
        }

        .modal-item-details::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, #00b4fa, transparent 30%) top left / 60% 1px no-repeat,
                linear-gradient(0deg, #00b4fa, transparent 30%) top left / 1px 60% no-repeat,
                linear-gradient(90deg, transparent 70%, #00b4fa) top right / 60% 1px no-repeat,
                linear-gradient(0deg, #00b4fa, transparent 30%) top right / 1px 60% no-repeat,
                linear-gradient(90deg, transparent 70%, #00b4fa) bottom right / 60% 1px no-repeat,
                linear-gradient(180deg, #00b4fa, transparent 30%) bottom right / 1px 60% no-repeat,
                linear-gradient(90deg, #00b4fa, transparent 30%) bottom left / 60% 1px no-repeat,
                linear-gradient(180deg, #00b4fa, transparent 30%) bottom left / 1px 60% no-repeat;
            z-index: 1;
        }

        .modal-item-details::after {
            content: '';
            position: absolute;
            top: 50%;
            right: 5px;
            width: 3px;
            height: 30px;
            background-color: rgba(0, 180, 250, 0.5);
            transform: translateY(-50%);
        }

        /* Thêm style cho phần item-info */
        .modal-item-info {
            display: flex;
            flex-direction: column;
            gap: 1px;
        }

        /* Style cho thông tin biến động giá */
        .price-fluctuation-container {
            background-color: rgba(0, 30, 60, 0.5);
            padding: 8px 12px;
            border-left: 2px solid #00b4fa;
            position: relative;
        }

        .price-fluctuation-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 10px;
            height: 10px;
            border-top: 2px solid #00b4fa;
            border-left: 2px solid #00b4fa;
        }

        .item-fluctuation {
            display: inline-block;
            padding: 2px 6px;
            font-size: 14px;
        }

        .item-fluctuation.up {
            color: #4cff64;
            text-shadow: 0 0 5px rgba(76, 255, 100, 0.5);
        }

        .item-fluctuation.down {
            color: #ff3b30;
            text-shadow: 0 0 5px rgba(255, 59, 48, 0.5);
        }

        /* Chỉnh sửa modal-item-image-container với viền futuristic */
        .modal-item-image-container {
            width: 100px;
            height: 100px;
            overflow: hidden;
            border: none;
            flex-shrink: 0;
            position: relative;
            box-shadow: 0 0 10px rgba(0, 180, 250, 0.3);
            z-index: 2;
        }

        .modal-item-image-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, #00b4fa, transparent 40%) top left / 100% 2px no-repeat,
                linear-gradient(0deg, #00b4fa, transparent 40%) top left / 2px 100% no-repeat,
                linear-gradient(180deg, #00b4fa, transparent 40%) bottom left / 2px 100% no-repeat,
                linear-gradient(90deg, transparent 60%, #00b4fa) top right / 100% 2px no-repeat,
                linear-gradient(0deg, #00b4fa, transparent 40%) top right / 2px 100% no-repeat,
                linear-gradient(180deg, #00b4fa, transparent 40%) bottom right / 2px 100% no-repeat,
                linear-gradient(-90deg, #00b4fa, transparent 40%) bottom right / 100% 2px no-repeat,
                linear-gradient(-90deg, transparent 60%, #00b4fa) bottom left / 100% 2px no-repeat;
            z-index: 1;
            pointer-events: none;
        }

        .modal-item-image-container::after {
            content: '';
            position: absolute;
            top: 5px;
            right: 5px;
            width: 10px;
            height: 10px;
            border-top: 2px solid #00b4fa;
            border-right: 2px solid #00b4fa;
            z-index: 2;
        }

        .modal-item-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: relative;
            z-index: 0;
        }

        /* Chỉnh sửa modal-item-label và modal-item-price với viền futuristic */
        .modal-item-label, .modal-item-price {
            font-weight: 600;
            color: #fff;
            background-color: rgba(0, 50, 100, 0.3);
            padding: 5px 15px;
            display: inline-block;
            text-shadow: 0 0 5px rgba(0, 180, 250, 0.8);
            border: none;
            position: relative;
            margin-bottom: 5px;
        }

        .modal-item-label::before, .modal-item-price::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, #00b4fa, transparent 40%) top left / 70% 1px no-repeat,
                linear-gradient(0deg, #00b4fa, transparent 40%) top left / 1px 100% no-repeat,
                linear-gradient(90deg, transparent 60%, #00b4fa) top right / 70% 1px no-repeat;
        }

        .modal-item-label::after,
        .modal-item-price::after {
            content: none;
        }

        /* Chỉnh sửa amount-selector với viền futuristic */
        .amount-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            background-color: rgba(0, 20, 40, 0.7);
            padding: 15px;
            border: none;
            position: relative;
        }

        .amount-selector::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, #00b4fa, transparent 20%) top left / 40% 1px no-repeat,
                linear-gradient(90deg, transparent 80%, #00b4fa) top right / 40% 1px no-repeat,
                linear-gradient(90deg, transparent 80%, #00b4fa) bottom right / 40% 1px no-repeat,
                linear-gradient(90deg, #00b4fa, transparent 20%) bottom left / 40% 1px no-repeat;
        }

        .amount-selector::after {
            content: none;
        }

        /* Thêm CSS cho item-image-container và item-image */
        .item-image-container {
            width: 100%;
            height: 80px;
            overflow: hidden;
            margin-bottom: 8px;
            border: 1px solid rgba(0, 180, 250, 0.3);
            position: relative;
            background-color: rgba(5, 15, 25, 0.6);
        }

        .item-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .item-card:hover .item-image {
            transform: scale(1.1);
        }

        /* Thêm màu nền cho modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        /* Style cho close-modal */
        .close-modal {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: rgba(255, 59, 48, 0.3);
            border: 1px solid rgba(255, 59, 48, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            z-index: 10;
            box-shadow: 0 0 8px rgba(255, 59, 48, 0.5);
        }

        .close-modal:hover {
            background-color: rgba(255, 59, 48, 0.5);
            box-shadow: 0 0 15px rgba(255, 59, 48, 0.7);
            transform: scale(1.1);
        }

        /* Căn chỉnh lại vị trí icon */
        .close-modal i {
            font-size: 18px;
            color: #ffffff;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
            line-height: 1;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 18px;
            height: 18px;
            justify-content: center;
            align-items: center;
        }

        /* Trường hợp Font Awesome không hoạt động, sử dụng chữ X thay thế */
        .close-modal i:empty::before {
            content: '✕';
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="preview-controls">
        <div class="zone-selector">
            <label>Khu vực:</label>
            <select id="zone-selector">
                <option value="black-market">CHỢ ĐẦU MỐI</option>
                <option value="pawn-shop">Tiệm Cầm Đồ</option>
            </select>
        </div>
        <button id="toggle-ui">Hiển thị UI</button>
        <button id="randomize-prices">Ngẫu nhiên giá</button>
        <div class="price-modifier">
            <label>Vật phẩm:</label>
            <select id="item-selector"></select>
            <button id="increase-price">+</button>
            <button id="decrease-price">-</button>
        </div>
    </div>

    <div class="container" id="main-container" style="display: none;">
        <div class="header">
            <h1 id="zone-name">Bán Vật Phẩm</h1>
            <div class="close-btn" id="close-btn">
                <i class="fas fa-times"></i>
            </div>
        </div>
        
        <div class="category-tabs" id="category-tabs">
            <!-- Categories will be added dynamically via JS -->
            <button class="category-tab active" data-category="all"><span>Tất cả</span></button>
            <button class="category-tab" data-category="nong_san"><span>Nông Sản</span></button>
            <button class="category-tab" data-category="khoang_san"><span>Khoáng Sản</span></button>
            <!-- Thêm các tab khác -->
        </div>
        
        <div class="items-container" id="items-container">
            <!-- Items will be added dynamically via JS -->
        </div>
    </div>
    
    <!-- Sell modal -->
    <div class="modal" id="sell-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><span id="modal-item-name">Vật phẩm</span></h2>
                <div class="close-modal" id="close-modal">
                    <i class="fas fa-times"></i>
                </div>
            </div>
            <div class="modal-body">
                <div class="modal-item-details">
                    <div class="modal-item-image-container">
                        <img id="modal-item-image" class="modal-item-image" src="" alt="Item Image">
                    </div>
                    <div class="modal-item-info">
                        <div class="modal-item-label" id="modal-item-label">Tên vật phẩm</div>
                        <div class="modal-item-price">Giá: $<span id="modal-item-price">0</span></div>
                        <div class="modal-item-price">Biến động: <span id="modal-item-fluctuation"></span>
                        </div>
                    </div>
                </div>
                
                <div class="amount-selector">
                    <button class="amount-btn" id="decrease-amount">-</button>
                    <input type="number" id="amount-input" min="1" value="1">
                    <button class="amount-btn" id="increase-amount">+</button>
                </div>
                
                <div class="total-price-container">
                    <div class="total-price-label">Tổng tiền :</div>
                    <div class="total-price-value"><span id="modal-total-price">0</span></div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancel-btn">Hủy bỏ</button>
                <button id="confirm-btn">Xác nhận bán</button>
            </div>
        </div>
    </div>
    
    <script>
        // Fake data for live preview
        const zones = {
            "black-market": {
                name: "CHỢ ĐẦU MỐI",
                categories: ['thu', 'lam_san', 'nong_san', 'khoang_san']
            },
            "pawn-shop": {
                name: "Tiệm Cầm Đồ",
                categories: ['nong_san', 'khoang_san']
            }
        };

        const items = [
            // Nông sản
            {
                name: "rice",
                label: "Gạo",
                basePrice: 50,
                category: "nong_san",
                fluctuationEnabled: true,
                stock: 150,
                image: "https://cdn.britannica.com/68/143268-050-917048EA/Beef-loin.jpg"
            },
            {
                name: "corn",
                label: "Bắp",
                basePrice: 30,
                category: "nong_san",
                fluctuationEnabled: true,
                stock: 200,
                image: "https://cdn.britannica.com/68/143268-050-917048EA/Beef-loin.jpg"
            },
            {
                name: "potato",
                label: "Khoai tây",
                basePrice: 20,
                category: "nong_san",
                fluctuationEnabled: true,
                stock: 120,
                image: "https://cdn.britannica.com/68/143268-050-917048EA/Beef-loin.jpg"
            },
            {
                name: "carrot",
                label: "Cà rốt",
                basePrice: 15,
                category: "nong_san",
                fluctuationEnabled: true,
                stock: 180,
                image: "https://cdn.britannica.com/68/143268-050-917048EA/Beef-loin.jpg"
            },
            {
                name: "tomato",
                label: "Cà chua",
                basePrice: 25,
                category: "nong_san",
                fluctuationEnabled: true,
                stock: 90,
                image: "https://cdn.britannica.com/68/143268-050-917048EA/Beef-loin.jpg"

            },
            {
                name: "wheat",
                label: "Lúa mì",
                basePrice: 40,
                category: "nong_san",
                fluctuationEnabled: true,
                stock: 240,
                image: "https://cdn.britannica.com/68/143268-050-917048EA/Beef-loin.jpg"
            },
            
            // Khoáng sản
            {
                name: "gold",
                label: "Vàng",
                basePrice: 1000,
                category: "khoang_san",
                fluctuationEnabled: true,
                stock: 15,
                image: "https://cdn.britannica.com/68/143268-050-917048EA/Beef-loin.jpg"
            },
            {
                name: "diamond",
                label: "Kim cương",
                basePrice: 1500,
                category: "khoang_san",
                fluctuationEnabled: true,
                stock: 8,
                image: "https://cdn.britannica.com/68/143268-050-917048EA/Beef-loin.jpg"
            },
            {
                name: "iron",
                label: "Sắt",
                basePrice: 100,
                category: "khoang_san",
                fluctuationEnabled: true,
                stock: 300,
                image: "https://cdn.britannica.com/68/143268-050-917048EA/Beef-loin.jpg"
            },
            {
                name: "copper",
                label: "Đồng",
                basePrice: 80,
                category: "khoang_san",
                fluctuationEnabled: true,
                stock: 220,
                image: "https://cdn.britannica.com/68/143268-050-917048EA/Beef-loin.jpg"
            },
            {
                name: "silver",
                label: "Bạc",
                basePrice: 500,
                category: "khoang_san",
                fluctuationEnabled: true,
                stock: 30,
                image: "https://cdn.britannica.com/68/143268-050-917048EA/Beef-loin.jpg"
            },
            {
                name: "coal",
                label: "Than đá",
                basePrice: 60,
                category: "khoang_san",
                fluctuationEnabled: true,
                stock: 400,
                image: "https://cdn.britannica.com/68/143268-050-917048EA/Beef-loin.jpg"
            },
            
            // Lâm sản
            {
                name: "wood",
                label: "Gỗ",
                basePrice: 80,
                category: "lam_san",
                fluctuationEnabled: true,
                stock: 250,
                image: "https://cdn.britannica.com/68/143268-050-917048EA/Beef-loin.jpg"
            },
            {
                name: "rubber",
                label: "Cao su",
                basePrice: 120,
                category: "lam_san",
                fluctuationEnabled: true,
                stock: 180,
                image: "https://cdn.britannica.com/68/143268-050-917048EA/Beef-loin.jpg"
            },
            {
                name: "pine",
                label: "Gỗ thông",
                basePrice: 90,
                category: "lam_san",
                fluctuationEnabled: true,
                stock: 210,
                image: "https://cdn.britannica.com/68/143268-050-917048EA/Beef-loin.jpg"
            },
            {
                name: "bamboo",
                label: "Tre",
                basePrice: 50,
                category: "lam_san",
                fluctuationEnabled: true,
                stock: 350,
                image: "https://cdn.britannica.com/68/143268-050-917048EA/Beef-loin.jpg"
            },
            {
                name: "oak",
                label: "Gỗ sồi",
                basePrice: 150,
                category: "lam_san",
                fluctuationEnabled: true,
                stock: 120,
                image: "https://cdn.britannica.com/68/143268-050-917048EA/Beef-loin.jpg"
            },
            {
                name: "maple",
                label: "Gỗ phong",
                basePrice: 130,
                category: "lam_san",
                fluctuationEnabled: true,
                stock: 100,
                image: "https://cdn.britannica.com/68/143268-050-917048EA/Beef-loin.jpg"
            },
            
            // Thú
            {
                name: "cow_meat",
                label: "Thịt bò",
                basePrice: 300,
                category: "thu",
                fluctuationEnabled: true,
                stock: 80,
                image: "https://cdn.britannica.com/68/143268-050-917048EA/Beef-loin.jpg"
            },
            {
                name: "chicken",
                label: "Gà",
                basePrice: 150,
                category: "thu",
                fluctuationEnabled: true,
                stock: 120,
                image: "https://cdn.britannica.com/07/183407-050-C35648B5/Chicken.jpg"
            },
            {
                name: "pork",
                label: "Thịt lợn",
                basePrice: 200,
                category: "thu",
                fluctuationEnabled: true,
                stock: 95,
                image: "https://cdn.britannica.com/68/143268-050-917048EA/Beef-loin.jpg"
            },
            {
                name: "leather",
                label: "Da thuộc",
                basePrice: 250,
                category: "thu",
                fluctuationEnabled: true,
                stock: 60,
                image: "https://cdn.britannica.com/68/143268-050-917048EA/Beef-loin.jpg"
            },
            {
                name: "milk",
                label: "Sữa",
                basePrice: 90,
                category: "thu",
                fluctuationEnabled: true,
                stock: 150,
                image: "https://cdn.britannica.com/68/143268-050-917048EA/Beef-loin.jpg"
            },
            {
                name: "wool",
                label: "Len",
                basePrice: 180,
                category: "thu",
                fluctuationEnabled: true,
                stock: 70,
                image: "https://cdn.britannica.com/68/143268-050-917048EA/Beef-loin.jpg"
            }
        ];

        // Map categories to Vietnamese names
        const categoryMap = {
            'all': 'Tất cả',
            'nong_san': 'Nông Sản',
            'khoang_san': 'Khoáng Sản',
            'lam_san': 'Lâm Sản',
            'thu': 'Thú'
        };

        // Global variables
        let currentZone = null;
        let currentPrices = {};
        let itemsData = [];
        let currentItem = null;
        let categories = ['all'];
        let selectedCategory = 'all';

        // Initialize the preview
        function initializePreview() {
            // Populate the item selector dropdown
            const itemSelector = $('#item-selector');
            items.forEach(item => {
                itemSelector.append(`<option value="${item.name}">${item.label}</option>`);
            });

            // Set event listeners for preview controls
            $('#toggle-ui').click(function() {
                const container = $('#main-container');
                if (container.css('display') === 'none') {
                    $(this).text('Ẩn UI');
                    const zoneId = $('#zone-selector').val();
                    currentZone = zones[zoneId];
                    loadZoneItems();
                    container.css('display', 'flex');
                } else {
                    $(this).text('Hiển thị UI');
                    container.css('display', 'none');
                }
            });

            $('#randomize-prices').click(function() {
                randomizePrices();
                filterItems();
            });

            $('#increase-price').click(function() {
                const itemName = $('#item-selector').val();
                if (currentPrices[itemName]) {
                    currentPrices[itemName] = Math.floor(currentPrices[itemName] * 1.1);
                } else {
                    const item = items.find(i => i.name === itemName);
                    currentPrices[itemName] = Math.floor(item.basePrice * 1.1);
                }
                filterItems();
            });

            $('#decrease-price').click(function() {
                const itemName = $('#item-selector').val();
                if (currentPrices[itemName]) {
                    currentPrices[itemName] = Math.floor(currentPrices[itemName] * 0.9);
                } else {
                    const item = items.find(i => i.name === itemName);
                    currentPrices[itemName] = Math.floor(item.basePrice * 0.9);
                }
                filterItems();
            });

            $('#zone-selector').change(function() {
                if ($('#main-container').css('display') !== 'none') {
                    const zoneId = $(this).val();
                    currentZone = zones[zoneId];
                    loadZoneItems();
                }
            });

            // Initialize prices
            items.forEach(item => {
                currentPrices[item.name] = item.basePrice;
            });

            // Initialize UI event listeners
            initUI();
        }

        function loadZoneItems() {
            // Reset data
            itemsData = [];
            categories = ['all'];

            // Set zone name in UI
            $('#zone-name').text(currentZone.name);

            // Filter items by allowed categories for this zone
            items.forEach(item => {
                if (currentZone.categories.includes(item.category)) {
                    itemsData.push(item);
                    
                    // Add category to list if not already there
                    if (!categories.includes(item.category)) {
                        categories.push(item.category);
                    }
                }
            });

            // Populate categories and items
            populateCategories();
            filterItems();
        }

        function randomizePrices() {
            items.forEach(item => {
                if (item.fluctuationEnabled) {
                    const fluctuationPercent = Math.floor(Math.random() * 41) - 20; // -20% to +20%
                    currentPrices[item.name] = Math.floor(item.basePrice * (1 + (fluctuationPercent / 100)));
                }
            });
        }

        // Function to initialize the UI
        function initUI() {
            // Event listeners
            $('#close-btn').click(function() {
                $('#main-container').hide();
                $('#toggle-ui').text('Hiển thị UI');
            });
            
            $('#close-modal').click(closeModal);
            $('#cancel-btn').click(closeModal);
            $('#confirm-btn').click(function() {
                alert('Đã bán vật phẩm!');
                closeModal();
            });
            
            $('#decrease-amount').click(decreaseAmount);
            $('#increase-amount').click(increaseAmount);
            
            // Handle amount input changes
            $('#amount-input').on('input', function() {
                updateTotalPrice();
            });
        }

        // Function to close the modal
        function closeModal() {
            $('#sell-modal').hide();
        }

        // Function to open the sell modal
        function openSellModal(itemName) {
            // Find the item in our data
            currentItem = itemsData.find(item => item.name === itemName);
            
            if (!currentItem) return;
            
            // Get current price
            const currentPrice = currentPrices[itemName] || currentItem.basePrice;
            
            // Show fluctuation if available
            let fluctuation = '';
            if (currentPrices[itemName] && currentItem.fluctuationEnabled) {
                const diff = currentPrices[itemName] - currentItem.basePrice;
                const percentChange = Math.floor((diff / currentItem.basePrice) * 100);
                
                if (percentChange > 0) {
                    fluctuation = `<span class="item-fluctuation up">(↑${percentChange}%)</span>`;
                } else if (percentChange < 0) {
                    fluctuation = `<span class="item-fluctuation down">(↓${Math.abs(percentChange)}%)</span>`;
                }
            }
            
            // Set modal content
            $('#modal-item-name').text(currentItem.label);
            $('#modal-item-label').text(currentItem.label);
            $('#modal-item-price').text(currentPrice);
            $('#modal-item-fluctuation').html(fluctuation);
            $('#modal-item-image').attr('src', currentItem.image);
            $('#modal-item-stock').text(currentItem.stock);
            $('#amount-input').val(1);
            updateTotalPrice();
            
            // Show modal
            $('#sell-modal').css('display', 'flex');
        }

        // Function to update total price in modal
        function updateTotalPrice() {
            if (!currentItem) return;
            
            const amount = parseInt($('#amount-input').val()) || 0;
            const price = currentPrices[currentItem.name] || currentItem.basePrice;
            const total = amount * price;
            
            $('#modal-total-price').text(total);
        }

        // Function to increase amount
        function increaseAmount() {
            const currentAmount = parseInt($('#amount-input').val()) || 0;
            $('#amount-input').val(currentAmount + 1);
            updateTotalPrice();
        }

        // Function to decrease amount
        function decreaseAmount() {
            const currentAmount = parseInt($('#amount-input').val()) || 0;
            if (currentAmount > 1) {
                $('#amount-input').val(currentAmount - 1);
                updateTotalPrice();
            }
        }

        // Function to populate category tabs
        function populateCategories() {
            // Clear existing tabs except "All"
            $('#category-tabs').html('<button class="category-tab active" data-category="all"><span>Tất cả</span></button>');
            
            // Add unique categories
            categories.forEach(category => {
                if (category !== 'all') {
                    const categoryName = categoryMap[category] || category;
                    $('#category-tabs').append(`<button class="category-tab" data-category="${category}"><span>${categoryName}</span></button>`);
                }
            });
            
            // Add click event for category tabs
            $('.category-tab').click(function() {
                $('.category-tab').removeClass('active');
                $(this).addClass('active');
                
                selectedCategory = $(this).data('category');
                filterItems();
            });
        }

        // Function to populate items in the UI
        function populateItems(items) {
            $('#items-container').empty();
            
            // Create 15 empty slots (5x3 grid)
            for (let i = 0; i < 15; i++) {
                $('#items-container').append(`<div class="item-card" style="visibility: hidden;"></div>`);
            }
            
            // Replace empty slots with actual items
            items.forEach((item, index) => {
                if (index < 15) { // Only show max 15 items
                    // Get current price for the item
                    const currentPrice = currentPrices[item.name] || item.basePrice;
                    
                    // Create fluctuation indicator if applicable
                    let fluctuation = '';
                    if (currentPrices[item.name] && item.fluctuationEnabled) {
                        const diff = currentPrices[item.name] - item.basePrice;
                        const percentChange = Math.floor((diff / item.basePrice) * 100);
                        
                        if (percentChange > 0) {
                            fluctuation = `<span class="item-fluctuation up">(↑${percentChange}%)</span>`;
                        } else if (percentChange < 0) {
                            fluctuation = `<span class="item-fluctuation down">(↓${Math.abs(percentChange)}%)</span>`;
                        }
                    }
                    
                    // Create item card HTML
                    const itemCard = `
                        <div class="item-card" data-item="${item.name}">
                            <div class="item-image-container">
                                <img src="${item.image}" alt="${item.label}" class="item-image">
                            </div>
                            <div class="item-name">${item.label}</div>
                            <div class="item-price">$${currentPrice} ${fluctuation}</div>
                        </div>
                    `;
                    
                    // Replace the empty slot
                    $('#items-container').children().eq(index).replaceWith(itemCard);
                }
            });
            
            // Add click event for items
            $('.item-card').each(function() {
                if ($(this).attr('data-item')) {
                    $(this).click(function() {
                        const itemName = $(this).data('item');
                        openSellModal(itemName);
                    });
                }
            });
        }

        // Function to filter items based on category
        function filterItems() {
            // Filter by category
            const filteredItems = itemsData.filter(item => {
                return selectedCategory === 'all' || item.category === selectedCategory;
            });
            
            // Update UI
            populateItems(filteredItems);
        }

        // Initialize when document is ready
        $(document).ready(function() {
            initializePreview();
        });
    </script>
</body>
</html> 